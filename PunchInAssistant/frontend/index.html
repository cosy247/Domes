<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
        <script src="./js/sha1.js"></script>
        <script src="./js/api.js"></script>
    </head>
    <body>
        <button onclick="senShare()">发送分享</button>
    </body>

    <script>
        async function senShare() {
            const appId = 'wx8f6343e976dfba3a';

            // 获取token
            const tokenData = await api.get({
                url: 'https://api.weixin.qq.com/cgi-bin/token',
                data: {
                    grant_type: 'client_credential',
                    appid: appId,
                    secret: '336a3a694738cdfce480cc65101c2ae1'
                }
            });
            if(!tokenData.access_token) {
                return false
            };

            // 获取ticket
            const ticketData = await api.get({
                url: 'https://api.weixin.qq.com/cgi-bin/ticket/getticket',
                data: {
                    access_token: tokenData.access_token,
                    type: jsapi
                }
            })
            if(tokenData.errmsg !== 'ok') {
                return false;
            }

            // 配置分享信息
            const timestamp = Date.now();
            const nonceStr = 'juaasdgasdg';
            const signature = sha1(`noncestr=${nonceStr}&jsapi_ticket=${ticketData.ticket}&timestamp=${timestamp}&url=${location.href}`);
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId, // 必填，公众号的唯一标识
                timestamp, // 必填，生成签名的时间戳
                nonceStr, // 必填，生成签名的随机串
                signature, // 必填，签名
                jsApiList: ['onMenuShareAppMessage'], // 必填，需要使用的JS接口列表
            });

            // 分享
            wx.ready(() => {
                wx.onMenuShareAppMessage({
                    title: '打卡咯',
                    desc: '打卡测试呢',
                    link: 'link',
                    imgUrl: 'imgUrl',
                    success: function () {},
                    cancel: function () {},
                });
            })
        }
        // 获取Access token {"access_token":"ACCESS_TOKEN","expires_in":7200}
        // https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wx8f6343e976dfba3a&secret=336a3a694738cdfce480cc65101c2ae1

        // api.get({
        //     url: 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wx8f6343e976dfba3a&secret=336a3a694738cdfce480cc65101c2ae1',
        // }).then((data) => {
        //     data.access_token;
        // });

        // wx.ready(function () {
            // 自定义“分享到朋友圈”
            // wx.onMenuShareTimeline({
            //     title: title,
            //     link: link,
            //     imgUrl: imgUrl,
            //     success: function () {},
            //     cancel: function () {},
            // });
            // 自定义“分享到QQ空间”
            // wx.onMenuShareQZone({
            //     title: title,
            //     desc: desc,
            //     link: link,
            //     imgUrl: imgUrl,
            //     success: function () {},
            //     cancel: function () {},
            // });
            // 自定义“分享给微信好友”
            // wx.onMenuShareAppMessage({
            //     title: 'title',
            //     desc: 'desc',
            //     link: 'link',
            //     imgUrl: 'imgUrl',
            //     success: function () {},
            //     cancel: function () {},
            // });
            // 自定义分享给QQ好友”
            // wx.onMenuShareQQ({
            //     title: title,
            //     desc: desc,
            //     link: link,
            //     imgUrl: imgUrl,
            //     success: function () {},
            //     cancel: function () {},
            // });
        // });
    </script>
</html>
